<!DOCTYPE html>
<html lang="ko" data-theme="light">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>ë§ì”€ â€” ì„±ê²½ AI í•´ì„¤</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Jua&family=Noto+Serif+KR:wght@300;400;600&family=Noto+Sans+KR:wght@300;400;700&family=Black+Han+Sans&display=swap" rel="stylesheet">
<style>

/* â•â• ê¸°ë³¸ ë³€ìˆ˜ & ë¼ì´íŠ¸ ëª¨ë“œ â•â• */
:root, [data-theme="light"] {
  --vt-size:    17px; /* ë³¸ë¬¸ ê¸°ë³¸ ê¸€ì”¨ í¬ê¸° ë³€ìˆ˜ ì¶”ê°€! */
  
  --bg:         #fdf9f2;
  --bg2:        #f5eee0;
  --surface:    #ffffff;
  --surface2:   #faf4e8;
  --gold:       #9a5e00;
  --gold2:      #c07800;
  --gold-dim:   rgba(154,94,0,.08);
  --gold-glow:  rgba(154,94,0,.18);
  --text:       #1e1408;
  --text2:      #6b5030;
  --text3:      #b09060;
  --border:     rgba(154,94,0,.18);
  --border2:    rgba(0,0,0,.07);
  --red:        #c0392b;
  --vhl-bg:     rgba(154,94,0,.06);
  --vhl-border: rgba(154,94,0,.2);
  --shadow:     0 4px 20px rgba(80,50,10,.11);
  --prog-track: rgba(0,0,0,.07);
  --hdr-bg:     rgba(253,249,242,.96);
  --sheet-bg:   #fdf9f2;
  --pill-bg:    #ede0c4;
  --sect-head:  #7a4800;
  --sect-line:  rgba(154,94,0,.15);
  --toggle-off: #e8dfc8;
  --toggle-on:  #c8a060;
}

/* â•â• ë‹¤í¬ ëª¨ë“œ â•â• */
[data-theme="dark"] {
  --bg:         #111009;
  --bg2:        #1c1a14;
  --surface:    #252118;
  --surface2:   #302c20;
  --gold:       #e8b84b;
  --gold2:      #f5d47a;
  --gold-dim:   rgba(232,184,75,.11);
  --gold-glow:  rgba(232,184,75,.22);
  --text:       #f2ecdc;
  --text2:      #a09080;
  --text3:      #5c5448;
  --border:     rgba(232,184,75,.18);
  --border2:    rgba(255,255,255,.07);
  --red:        #e05555;
  --vhl-bg:     rgba(232,184,75,.08);
  --vhl-border: rgba(232,184,75,.22);
  --shadow:     0 6px 28px rgba(0,0,0,.55);
  --prog-track: rgba(255,255,255,.07);
  --hdr-bg:     rgba(17,16,9,.94);
  --sheet-bg:   #1c1a14;
  --pill-bg:    #2e2a1e;
  --sect-head:  #d4a040;
  --sect-line:  rgba(232,184,75,.15);
  --toggle-off: #2e2a1e;
  --toggle-on:  #8a6820;
}

*, *::before, *::after { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color:transparent; }
body {
  font-family:'Noto Sans KR',sans-serif;
  background:var(--bg); color:var(--text);
  min-height:100vh; overflow-x:hidden;
  transition:background .3s,color .3s;
}

/* â”â”â” í—¤ë” â”â”â” */
.hdr {
  position:sticky; top:0; z-index:200;
  background:var(--hdr-bg); backdrop-filter:blur(20px);
  border-bottom:1px solid var(--border2);
  height:58px; display:flex; align-items:center; padding:0 10px; gap:6px; /* ëª¨ë°”ì¼ ë§ì¶¤ ê°„ê²© ì¶•ì†Œ */
}
.hdr-icon-btn {
  width:36px; height:36px; border-radius:11px; /* ì‚¬ì´ì¦ˆ ì•½ê°„ ì¶•ì†Œ */
  border:1px solid var(--border2); background:var(--surface);
  color:var(--text2); cursor:pointer; flex-shrink:0;
  display:flex; align-items:center; justify-content:center;
  font-size:16px; transition:all .14s;
}
.hdr-icon-btn:active { transform:scale(0.87); }

.hdr-logo { flex:1; display:flex; align-items:center; justify-content:center; gap:5px; }
.hdr-logo-cross { font-size:13px; color:var(--gold); opacity:.7; }
.hdr-logo-text {
  font-family:'Black Han Sans',sans-serif;
  font-size:21px; letter-spacing:3px;
}
[data-theme="light"] .hdr-logo-text {
  background:linear-gradient(135deg,#5c2e00,#9a5e00,#c07800);
  -webkit-background-clip:text; -webkit-text-fill-color:transparent;
}
[data-theme="dark"] .hdr-logo-text {
  background:linear-gradient(135deg,#e8b84b,#f5d47a,#fffbe0);
  -webkit-background-clip:text; -webkit-text-fill-color:transparent;
}

.hdr-crumb {
  flex:1; text-align:center; font-family:'Jua',sans-serif;
  font-size:16px; color:var(--text);
  white-space:nowrap; overflow:hidden; text-overflow:ellipsis; display:none;
}

/* ìš”ì•½ ë²„íŠ¼ */
.hdr-ai-btn {
  display:none; align-items:center; gap:4px;
  padding:6px 10px; border-radius:18px;
  background:var(--surface); border:1.5px solid var(--gold);
  color:var(--gold); font-family:'Jua',sans-serif; font-weight:600;
  font-size:13px; cursor:pointer; white-space:nowrap; transition:all .14s;
}
.hdr-ai-btn:active { transform:scale(0.92); background:var(--gold-dim); }

/* â”â”â” í°íŠ¸ í¬ê¸° ì¡°ì ˆ ë²„íŠ¼ â”â”â” */
.hdr-font-ctrl {
  display:flex; align-items:center; gap:2px; flex-shrink:0;
  background:var(--surface2); border:1px solid var(--border2);
  border-radius:12px; padding:2px;
}
.hdr-font-btn {
  background:none; border:none; color:var(--text2);
  font-family:'Jua',sans-serif; font-size:14px;
  padding:4px 8px; cursor:pointer; border-radius:10px; transition:all .14s;
}
.hdr-font-btn:active { background:var(--surface); box-shadow:0 2px 4px rgba(0,0,0,.05); }

/* í…Œë§ˆ í† ê¸€ */
.theme-toggle { display:flex; align-items:center; gap:6px; flex-shrink:0; cursor:pointer; }
.toggle-pill {
  width:50px; height:26px; border-radius:14px;
  background:var(--pill-bg); border:1px solid var(--border2);
  position:relative; display:flex; align-items:center; padding:0 4px; justify-content:space-between;
}
.toggle-pill-icon { font-size:12px; z-index:1; pointer-events:none; }
.toggle-knob {
  position:absolute; width:20px; height:20px; border-radius:50%;
  background:var(--gold); box-shadow:0 2px 6px rgba(0,0,0,.25);
  top:2px; left:2px; transition:transform .32s cubic-bezier(.34,1.5,.64,1);
}
[data-theme="dark"] .toggle-knob { transform:translateX(24px); }

/* â”â”â” íƒ­ë°” â”â”â” */
.tabbar {
  display:flex; background:var(--bg2); border-bottom:1px solid var(--border2);
  padding:0 16px; position:sticky; top:58px; z-index:190;
}
.tab {
  flex:1; padding:13px 0 10px; border:none; background:none; color:var(--text3);
  cursor:pointer; font-family:'Jua',sans-serif; font-size:15px;
  border-bottom:2.5px solid transparent; transition:all .2s;
}
.tab.on { color:var(--gold); border-bottom-color:var(--gold); }

/* â”â”â” í˜ì´ì§€ â”â”â” */
.page { display:none; }
.page.on { display:block; }

/* â”â”â” í™ˆ íˆì–´ë¡œ â”â”â” */
.home-hero {
  padding:28px 20px 20px; text-align:center;
  border-bottom:1px solid var(--border2); position:relative; overflow:hidden;
}
.home-hero::before {
  content:'âœ'; position:absolute; font-size:200px; font-family:serif;
  color:var(--gold); opacity:.04; top:50%; left:50%; transform:translate(-50%,-50%); pointer-events:none;
}
.hero-badge {
  display:inline-block; padding:4px 12px; border-radius:20px;
  background:var(--gold-dim); border:1px solid var(--border);
  color:var(--gold); font-family:'Jua',sans-serif; font-size:12px; margin-bottom:10px;
}
.hero-title {
  font-family:'Black Han Sans',sans-serif;
  font-size:50px; line-height:1; margin-bottom:6px; letter-spacing:4px;
}
[data-theme="light"] .hero-title {
  background:linear-gradient(160deg,#5c2e00,#9a5e00,#d08010);
  -webkit-background-clip:text; -webkit-text-fill-color:transparent;
}
[data-theme="dark"] .hero-title {
  background:linear-gradient(160deg,#fff6d0,#e8b84b,#c8870a);
  -webkit-background-clip:text; -webkit-text-fill-color:transparent;
}
.hero-sub { font-family:'Jua',sans-serif; font-size:15px; color:var(--text3); }

/* â”â”â” êµ¬ì•½/ì‹ ì•½ íƒ­ ë²„íŠ¼ â”â”â” */
.sect-toggle-row {
  display:flex; gap:10px; padding:18px 14px 0;
}
.sect-toggle-btn {
  flex:1; display:flex; align-items:center; justify-content:center;
  padding:16px 14px;
  border-radius:14px;
  background:var(--surface); border:1.5px solid var(--border2);
  color:var(--text2); font-family:'Jua',sans-serif; 
  font-size:18px;
  cursor:pointer; transition:all .2s; user-select:none;
}
.sect-toggle-btn.open {
  border-color:var(--gold); color:var(--gold);
  background:var(--surface2); box-shadow:0 0 12px var(--gold-glow);
}
.sect-toggle-btn:active { transform:scale(0.96); }

/* ì„¹ì…˜ ì»¨í…Œì´ë„ˆ â€” ì—´ê¸°/ë‹«ê¸° ì• ë‹ˆ */
.sect-container {
  overflow:hidden;
  transition:max-height .35s cubic-bezier(.4,0,.2,1), opacity .3s;
  max-height:0; opacity:0;
}
.sect-container.open {
  max-height:3000px; opacity:1;
}

/* â”â”â” ì±… ê·¸ë¦¬ë“œ â”â”â” */
.book-grid {
  display:grid; grid-template-columns:repeat(3,1fr);
  gap:7px; padding:14px 14px 4px;
}
.book-card {
  background:var(--surface); border:1.5px solid var(--border2);
  border-radius:14px; padding:13px 8px 11px;
  cursor:pointer; text-align:center; transition:all .16s;
}
.book-card:active { transform:scale(0.95); background:var(--surface2); }
.book-card.last-visited {
  border-color:var(--gold); background:var(--surface2); box-shadow:0 0 14px var(--gold-glow);
}
.book-card-name { font-family:'Jua',sans-serif; font-size:14px; color:var(--gold); margin-bottom:2px; }
.book-card-sub { font-family:'Noto Sans KR',sans-serif; font-size:10px; color:var(--text3); font-weight:400; }

/* ì±… ëª©ë¡ ì•„ë˜ ì—¬ë°± */
.book-list-bottom { height:16px; }
/* ì „ì²´ í™ˆ ìŠ¤í¬ë¡¤ í•˜ë‹¨ ì—¬ë°± */
.home-scroll-end { height:80px; }

/* â”â”â” ì±… ìš”ì•½ ë²„íŠ¼ â”â”â” */
.bk-summary-btn {
  width:100%; padding:16px 20px; border-radius:14px;
  background:var(--surface); border:1.5px solid var(--gold);
  color:var(--gold); font-family:'Jua',sans-serif; font-size:16px; font-weight:600;
  cursor:pointer; display:flex; align-items:center; justify-content:center; gap:6px; transition:all .14s;
}
.bk-summary-btn:active { transform:scale(0.97); background:var(--gold-dim); }

/* â”â”â” ì¥ ê·¸ë¦¬ë“œ â”â”â” */
.ch-grid {
  display:grid; grid-template-columns:repeat(auto-fill,minmax(52px,1fr));
  gap:8px; padding:12px 14px 90px;
}
.ch-btn {
  aspect-ratio:1; border-radius:14px;
  background:var(--surface); border:1.5px solid var(--border2);
  color:var(--text2); font-family:'Jua',sans-serif; font-size:15px;
  display:flex; align-items:center; justify-content:center; cursor:pointer; transition:all .14s;
}
.ch-btn:active { transform:scale(0.88); }
.ch-btn.last-visited {
  border-color:var(--gold); background:var(--gold-dim); color:var(--gold); box-shadow:0 0 10px var(--gold-glow);
}

/* â”â”â” ì§„í–‰ ë°” â”â”â” */
.progress-wrap {
  position:sticky; top:104px; z-index:150;
  background:var(--bg2); padding:9px 16px; border-bottom:1px solid var(--border2);
  display:flex; align-items:center; gap:10px;
}
.progress-info { font-family:'Jua',sans-serif; font-size:12px; color:var(--text3); white-space:nowrap; }
.progress-info b { color:var(--gold); }
.progress-track { flex:1; height:5px; border-radius:3px; background:var(--prog-track); overflow:hidden; }
.progress-fill {
  height:100%; border-radius:3px;
  background:linear-gradient(90deg,var(--gold),var(--gold2));
  transition:width .45s cubic-bezier(.4,0,.2,1);
  box-shadow:0 0 8px var(--gold-glow);
}
.progress-pct { font-family:'Jua',sans-serif; font-size:12px; color:var(--gold); white-space:nowrap; }

/* â”â”â” ë³¸ë¬¸ â”â”â” */
.verses-wrap { padding:14px 14px 100px; }

.verse-row {
  display:flex; flex-direction:column;
  padding:12px 12px; border-radius:14px; margin-bottom:3px;
  cursor:pointer; transition:background .14s; border:1.5px solid transparent;
}
.verse-row:active { background:var(--surface); }
.verse-row.hl { background:var(--vhl-bg); border-color:var(--vhl-border); }

.verse-main { display:flex; gap:10px; }
.vn {
  font-family:'Jua',sans-serif; font-size:12px; color:var(--gold);
  min-width:20px; text-align:right; padding-top:5px; opacity:.65;
}
.vt {
  font-family:'Noto Serif KR',serif;
  font-size:var(--vt-size); /* ë³€ìˆ˜ë¡œ ì‹¤ì‹œê°„ ì¡°ì ˆë˜ê²Œ ë³€ê²½! */
  line-height:1.95; color:var(--text); word-break:keep-all; flex:1;
  transition:font-size 0.2s; /* ë¶€ë“œëŸ½ê²Œ ì»¤ì§€ê²Œ */
}

/* ì ˆ ì•¡ì…˜ â€” ì˜¤ë¥¸ìª½ ì •ë ¬, êµ¬ë¶„ì„  ì—†ìŒ */
.verse-actions {
  display:none; justify-content:flex-end; gap:7px; margin-top:10px;
}
.verse-row.hl .verse-actions { display:flex; }

.va-btn {
  display:flex; align-items:center; gap:4px;
  padding:6px 13px; border-radius:18px;
  font-family:'Jua',sans-serif; font-size:13px;
  cursor:pointer; transition:all .12s; white-space:nowrap;
  border:1.5px solid var(--border); background:var(--surface2); color:var(--text2);
}
.va-btn:active { transform:scale(0.91); }

/* ë³¸ë¬¸ AI í•´ì„¤ ë²„íŠ¼ */
.va-btn-ai {
  background:var(--surface); border:1.5px solid var(--gold);
  color:var(--gold); font-weight:600; 
}
.va-btn-ai:active { background:var(--gold-dim); }

/* â”â”â” í•˜ë‹¨ ì´ì „/ë‹¤ìŒ â”â”â” */
.ch-nav {
  position:fixed; bottom:0; left:0; right:0;
  display:flex; gap:10px; padding:10px 14px 14px;
  background:var(--hdr-bg); border-top:1px solid var(--border2);
  backdrop-filter:blur(20px); z-index:100;
}
.ch-nav-btn {
  flex:1; padding:13px; border-radius:14px;
  background:var(--surface); border:1.5px solid var(--border2);
  color:var(--text2); font-family:'Jua',sans-serif; font-size:15px;
  cursor:pointer; transition:all .14s;
}
.ch-nav-btn:active { transform:scale(0.96); background:var(--surface2); }

/* â”â”â” ë¶ë§ˆí¬ â”â”â” */
.bm-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:16px; }
.bm-count { font-family:'Jua',sans-serif; font-size:15px; color:var(--text2); }
.bm-clear-btn {
  padding:7px 14px; border-radius:10px;
  background:rgba(192,57,43,.09); border:1px solid rgba(192,57,43,.3);
  color:var(--red); font-family:'Jua',sans-serif; font-size:13px; cursor:pointer; transition:all .14s;
}
.bm-clear-btn:active { transform:scale(0.93); }
.bm-list { display:flex; flex-direction:column; gap:10px; padding-bottom:80px; }
.bm-card {
  background:var(--surface); border:1.5px solid var(--border2);
  border-radius:16px; padding:16px; display:flex; flex-direction:column; gap:10px; transition:all .14s;
}
.bm-card:active { transform:scale(0.98); }
.bm-top { display:flex; justify-content:space-between; align-items:flex-start; }
.bm-title { font-family:'Jua',sans-serif; color:var(--gold); font-size:14px; cursor:pointer; }
.bm-del { background:none; border:none; color:var(--text3); cursor:pointer; font-size:17px; padding:2px 4px; }
.bm-verse-text { 
  font-family:'Noto Serif KR',serif; 
  font-size:calc(var(--vt-size) - 2px); /* ë³¸ë¬¸ í¬ê¸°ì— ë¹„ë¡€ */
  line-height:1.85; color:var(--text2); word-break:keep-all; transition:font-size 0.2s;
}
.bm-empty { text-align:center; padding:80px 20px; color:var(--text3); font-family:'Jua',sans-serif; font-size:16px; line-height:2; }

/* â”â”â” AI ì‹œíŠ¸ â”â”â” */
.overlay { position:fixed; inset:0; background:rgba(0,0,0,.52); backdrop-filter:blur(4px); z-index:300; display:none; }
.ai-sheet {
  position:fixed; bottom:0; left:0; right:0; z-index:310;
  background:var(--sheet-bg); border-radius:28px 28px 0 0; border-top:1.5px solid var(--border);
  transform:translateY(100%); transition:transform .35s cubic-bezier(.32,.72,0,1);
  max-height:82vh; display:flex; flex-direction:column;
}
.ai-sheet.on { transform:translateY(0); }
.ai-handle { width:40px; height:4px; border-radius:4px; background:var(--border2); margin:14px auto 0; flex-shrink:0; }

.ai-verse-quote {
  margin:14px 18px 0; padding:14px 16px;
  background:var(--gold-dim); border:1px solid var(--border); border-radius:14px;
  position:relative; flex-shrink:0;
}
.ai-verse-quote::before {
  content:'"'; position:absolute; top:-6px; left:10px;
  font-size:50px; font-family:serif; color:var(--gold); opacity:.2; line-height:1; pointer-events:none;
}
.ai-verse-ref { font-family:'Jua',sans-serif; font-size:12px; color:var(--gold); margin-bottom:6px; }
.ai-verse-text { 
  font-family:'Noto Serif KR',serif; 
  font-size:calc(var(--vt-size) - 3px); /* ë³¸ë¬¸ í¬ê¸°ì— ë¹„ë¡€ */
  line-height:1.8; color:var(--text2); word-break:keep-all; transition:font-size 0.2s;
}

.ai-header { padding:12px 18px 0; display:flex; align-items:center; gap:8px; flex-shrink:0; }
.ai-header-icon {
  width:32px; height:32px; border-radius:9px;
  background:var(--gold-dim); border:1px solid var(--border);
  display:flex; align-items:center; justify-content:center; font-size:14px; flex-shrink:0;
}
.ai-header-title { flex:1; font-family:'Jua',sans-serif; font-size:16px; color:var(--text); }
.ai-close-btn {
  width:30px; height:30px; border-radius:9px; background:var(--surface2); border:none;
  color:var(--text3); cursor:pointer; font-size:14px;
  display:flex; align-items:center; justify-content:center;
}
.ai-divider { height:1px; background:var(--border2); margin:12px 18px 0; flex-shrink:0; }
.ai-body { padding:16px 18px 24px; overflow-y:auto; flex:1; }
.ai-text { 
  font-family:'Noto Sans KR',sans-serif;
  font-size:calc(var(--vt-size) - 1px); /* ë³¸ë¬¸ í¬ê¸°ì— ë¹„ë¡€ */
  line-height:1.95; color:var(--text2); word-break:keep-all; transition:font-size 0.2s;
}
.ai-text strong { color:var(--gold); font-weight:700; }

.typing { display:inline-flex; gap:5px; align-items:center; padding:10px 0; }
.typing span { width:8px; height:8px; border-radius:50%; background:var(--gold); animation:blink 1.2s ease-in-out infinite; }
.typing span:nth-child(2) { animation-delay:.2s; }
.typing span:nth-child(3) { animation-delay:.4s; }
@keyframes blink {
  0%,80%,100%{opacity:.2;transform:scale(.8);}
  40%{opacity:1;transform:scale(1.1);}
}

@keyframes fadeUp {
  from{opacity:0;transform:translateY(8px);}
  to{opacity:1;transform:translateY(0);}
}
.verse-row { animation:fadeUp .24s ease both; }

.loading-box { text-align:center; padding:60px 20px; color:var(--text3); font-family:'Jua',sans-serif; font-size:15px; }
</style>
</head>
<body>

<div class="hdr">
  <button class="hdr-icon-btn" onclick="goHome()">ğŸ </button>
  <button class="hdr-icon-btn" id="btnBack" onclick="goBack()" disabled>â†</button>
  <div class="hdr-logo" id="hdrLogo">
    <span class="hdr-logo-cross">âœ</span>
    <span class="hdr-logo-text">ë§ì”€</span>
  </div>
  <div class="hdr-crumb" id="hdrCrumb"></div>
  
  <button class="hdr-ai-btn" id="hdrAiBtn" onclick="openChapterAi()">âœ¨ ìš”ì•½</button>
  
  <div class="hdr-font-ctrl">
    <button class="hdr-font-btn" onclick="changeFontSize(-1)">A-</button>
    <button class="hdr-font-btn" onclick="changeFontSize(1)">A+</button>
  </div>

  <div class="theme-toggle" onclick="toggleTheme()">
    <div class="toggle-pill">
      <span class="toggle-pill-icon">â˜€ï¸</span>
      <span class="toggle-pill-icon">ğŸŒ™</span>
      <div class="toggle-knob"></div>
    </div>
  </div>
  <button class="hdr-icon-btn" onclick="switchTab('bookmarks')">ğŸ”–</button>
</div>

<div class="tabbar">
  <button class="tab on" id="tab-bible"     onclick="switchTab('bible')">ğŸ“– ì„±ê²½ ì½ê¸°</button>
  <button class="tab"    id="tab-bookmarks" onclick="switchTab('bookmarks')">ğŸ”– ë‚´ ë¶ë§ˆí¬</button>
</div>

<div id="bible-page" class="page on">

  <div id="vHome">
    <div class="home-hero">
      <div class="hero-badge">ğŸ“œ ê°œì—­í•œê¸€ KRV</div>
      <div class="hero-title">ë§ì”€</div>
      <div class="hero-sub">ì„±ê²½, ì´ì œ ì‰½ê²Œ ì½ì ğŸ™Œ</div>
    </div>

    <div style="padding-bottom:80px;">

      <div class="sect-toggle-row" style="padding-bottom:0;">
        <button class="sect-toggle-btn open" id="btn-old" onclick="toggleSect('old')">
          <span>ğŸ“œ êµ¬ì•½ 39ê¶Œ</span>
        </button>
        <button class="sect-toggle-btn" id="btn-new" onclick="toggleSect('new')">
          <span>âœï¸ ì‹ ì•½ 27ê¶Œ</span>
        </button>
      </div>

      <div class="sect-container open" id="sect-old">
        <div class="book-grid" id="bookGridOld"></div>
        <div class="book-list-bottom"></div>
      </div>

      <div class="sect-container" id="sect-new">
        <div class="book-grid" id="bookGridNew"></div>
        <div class="book-list-bottom"></div>
      </div>

    </div>
  </div>

  <div id="vChapter" style="display:none">
    <div id="bkSummaryWrap" style="padding:14px 14px 0"></div>
    <div class="ch-grid" id="chGrid"></div>
  </div>

  <div id="vRead" style="display:none">
    <div class="progress-wrap">
      <div class="progress-info" id="progressInfo"></div>
      <div class="progress-track"><div class="progress-fill" id="progressFill" style="width:0%"></div></div>
      <div class="progress-pct" id="progressPct"></div>
    </div>
    <div class="verses-wrap" id="versesWrap"></div>
    <div class="ch-nav">
      <button class="ch-nav-btn" onclick="changeCh(-1)">â† ì´ì „ ì¥</button>
      <button class="ch-nav-btn" onclick="changeCh(1)">ë‹¤ìŒ ì¥ â†’</button>
    </div>
  </div>

</div>

<div id="bookmarks-page" class="page">
  <div id="bmWrap" style="padding:16px"></div>
</div>

<div class="overlay" id="overlay" onclick="closeAi()"></div>
<div class="ai-sheet" id="aiSheet">
  <div class="ai-handle"></div>
  <div class="ai-verse-quote" id="aiVerseQuote" style="display:none">
    <div class="ai-verse-ref"  id="aiVerseRef"></div>
    <div class="ai-verse-text" id="aiVerseText"></div>
  </div>
  <div class="ai-header">
    <div class="ai-header-icon">âœ¨</div>
    <div class="ai-header-title" id="shTitle">AI í•´ì„¤</div>
    <button class="ai-close-btn" onclick="closeAi()">âœ•</button>
  </div>
  <div class="ai-divider"></div>
  <div class="ai-body">
    <div class="ai-text" id="shBody">
      <div class="typing"><span></span><span></span><span></span></div>
    </div>
  </div>
</div>

<script>
const WORKER_URL = 'https://bible-ai-worker.hdh1231.workers.dev';

const BOOKS = [
  {id:"gen",name:"ì°½ì„¸ê¸°",   t:"old",c:50},{id:"exo",name:"ì¶œì• êµ½ê¸°", t:"old",c:40},
  {id:"lev",name:"ë ˆìœ„ê¸°",   t:"old",c:27},{id:"num",name:"ë¯¼ìˆ˜ê¸°",   t:"old",c:36},
  {id:"deu",name:"ì‹ ëª…ê¸°",   t:"old",c:34},{id:"jos",name:"ì—¬í˜¸ìˆ˜ì•„", t:"old",c:24},
  {id:"jdg",name:"ì‚¬ì‚¬ê¸°",   t:"old",c:21},{id:"rut",name:"ë£»ê¸°",     t:"old",c:4},
  {id:"1sa",name:"ì‚¬ë¬´ì—˜ìƒ", t:"old",c:31},{id:"2sa",name:"ì‚¬ë¬´ì—˜í•˜", t:"old",c:24},
  {id:"1ki",name:"ì—´ì™•ê¸°ìƒ", t:"old",c:22},{id:"2ki",name:"ì—´ì™•ê¸°í•˜", t:"old",c:25},
  {id:"1ch",name:"ì—­ëŒ€ìƒ",   t:"old",c:29},{id:"2ch",name:"ì—­ëŒ€í•˜",   t:"old",c:36},
  {id:"ezr",name:"ì—ìŠ¤ë¼",   t:"old",c:10},{id:"neh",name:"ëŠí—¤ë¯¸ì•¼", t:"old",c:13},
  {id:"est",name:"ì—ìŠ¤ë”",   t:"old",c:10},{id:"job",name:"ìš¥ê¸°",     t:"old",c:42},
  {id:"psa",name:"ì‹œí¸",     t:"old",c:150},{id:"pro",name:"ì ì–¸",    t:"old",c:31},
  {id:"ecc",name:"ì „ë„ì„œ",   t:"old",c:12},{id:"sng",name:"ì•„ê°€",     t:"old",c:8},
  {id:"isa",name:"ì´ì‚¬ì•¼",   t:"old",c:66},{id:"jer",name:"ì˜ˆë ˆë¯¸ì•¼", t:"old",c:52},
  {id:"lam",name:"ì˜ˆë ˆë¯¸ì•¼ì• ê°€",t:"old",c:5},{id:"ezk",name:"ì—ìŠ¤ê²”", t:"old",c:48},
  {id:"dan",name:"ë‹¤ë‹ˆì—˜",   t:"old",c:12},{id:"hos",name:"í˜¸ì„¸ì•„",   t:"old",c:14},
  {id:"jol",name:"ìš”ì—˜",     t:"old",c:3}, {id:"amo",name:"ì•„ëª¨ìŠ¤",   t:"old",c:9},
  {id:"oba",name:"ì˜¤ë°”ëŒœ",   t:"old",c:1}, {id:"jon",name:"ìš”ë‚˜",     t:"old",c:4},
  {id:"mic",name:"ë¯¸ê°€",     t:"old",c:7}, {id:"nah",name:"ë‚˜í›”",     t:"old",c:3},
  {id:"hab",name:"í•˜ë°•êµ­",   t:"old",c:3}, {id:"zep",name:"ìŠ¤ë°”ëƒ",   t:"old",c:3},
  {id:"hag",name:"í•™ê°œ",     t:"old",c:2}, {id:"zec",name:"ìŠ¤ê°€ë´",   t:"old",c:14},
  {id:"mal",name:"ë§ë¼ê¸°",   t:"old",c:4},
  {id:"mat",name:"ë§ˆíƒœë³µìŒ", t:"new",c:28},{id:"mrk",name:"ë§ˆê°€ë³µìŒ", t:"new",c:16},
  {id:"luk",name:"ëˆ„ê°€ë³µìŒ", t:"new",c:24},{id:"jhn",name:"ìš”í•œë³µìŒ", t:"new",c:21},
  {id:"act",name:"ì‚¬ë„í–‰ì „", t:"new",c:28},{id:"rom",name:"ë¡œë§ˆì„œ",   t:"new",c:16},
  {id:"1co",name:"ê³ ë¦°ë„ì „ì„œ",t:"new",c:16},{id:"2co",name:"ê³ ë¦°ë„í›„ì„œ",t:"new",c:13},
  {id:"gal",name:"ê°ˆë¼ë””ì•„ì„œ",t:"new",c:6},{id:"eph",name:"ì—ë² ì†Œì„œ", t:"new",c:6},
  {id:"php",name:"ë¹Œë¦½ë³´ì„œ", t:"new",c:4}, {id:"col",name:"ê³¨ë¡œìƒˆì„œ",  t:"new",c:4},
  {id:"1th",name:"ë°ì‚´ë¡œë‹ˆê°€ì „ì„œ",t:"new",c:5},{id:"2th",name:"ë°ì‚´ë¡œë‹ˆê°€í›„ì„œ",t:"new",c:3},
  {id:"1ti",name:"ë””ëª¨ë°ì „ì„œ",t:"new",c:6},{id:"2ti",name:"ë””ëª¨ë°í›„ì„œ",t:"new",c:4},
  {id:"tit",name:"ë””ë„ì„œ",   t:"new",c:3},{id:"phm",name:"ë¹Œë ˆëª¬ì„œ", t:"new",c:1},
  {id:"heb",name:"íˆë¸Œë¦¬ì„œ", t:"new",c:13},{id:"jas",name:"ì•¼ê³ ë³´ì„œ", t:"new",c:5},
  {id:"1pe",name:"ë² ë“œë¡œì „ì„œ",t:"new",c:5},{id:"2pe",name:"ë² ë“œë¡œí›„ì„œ",t:"new",c:3},
  {id:"1jn",name:"ìš”í•œ1ì„œ",  t:"new",c:5},{id:"2jn",name:"ìš”í•œ2ì„œ",  t:"new",c:1},
  {id:"3jn",name:"ìš”í•œ3ì„œ",  t:"new",c:1},{id:"jud",name:"ìœ ë‹¤ì„œ",   t:"new",c:1},
  {id:"rev",name:"ìš”í•œê³„ì‹œë¡",t:"new",c:22}
];

let S = {view:'home', t:'old', bk:null, ch:1, hist:['home'], cache:{}};
let selIdx = -1;

/* â”â”â” ë¡œì»¬ ì„¤ì • ë¶ˆëŸ¬ì˜¤ê¸° â”â”â” */
let theme = localStorage.getItem('bible_theme') || 'light';
let vSize = parseInt(localStorage.getItem('bible_vsize')) || 17;

let sectOpen = {old: true, new: false};

/* â”â”â” í°íŠ¸ í¬ê¸° ì¡°ì ˆ â”â”â” */
function applyFontSize(size) {
  vSize = Math.max(12, Math.min(size, 34)); // ìµœì†Œ 12px ~ ìµœëŒ€ 34px ì œí•œ
  document.documentElement.style.setProperty('--vt-size', vSize + 'px');
  localStorage.setItem('bible_vsize', vSize);
}
function changeFontSize(delta) {
  applyFontSize(vSize + delta);
}

function toggleSect(t) {
  if (sectOpen[t]) return; 
  const other = t === 'old' ? 'new' : 'old';
  
  sectOpen[t] = true;
  sectOpen[other] = false;

  document.getElementById('btn-' + t).classList.add('open');
  document.getElementById('sect-' + t).classList.add('open');

  document.getElementById('btn-' + other).classList.remove('open');
  document.getElementById('sect-' + other).classList.remove('open');
}

function applyTheme(t) {
  document.documentElement.setAttribute('data-theme', t);
  localStorage.setItem('bible_theme', t);
  theme = t;
}
function toggleTheme() { applyTheme(theme === 'light' ? 'dark' : 'light'); }

function switchTab(t) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('on'));
  document.querySelectorAll('.tab').forEach(b => b.classList.remove('on'));
  document.getElementById(t + '-page').classList.add('on');
  document.getElementById('tab-' + t).classList.add('on');
  clearSel();
  if (t === 'bible') {
    renderView();
  } else {
    renderBookmarks();
    document.getElementById('btnBack').disabled = false;
    document.getElementById('hdrLogo').style.display  = 'none';
    document.getElementById('hdrCrumb').style.display = 'block';
    document.getElementById('hdrCrumb').innerText = 'ë‚´ ë¶ë§ˆí¬';
    document.getElementById('hdrAiBtn').style.display = 'none';
  }
}

function renderBooks() {
  ['old', 'new'].forEach(t => {
    document.getElementById('bookGrid' + (t === 'old' ? 'Old' : 'New')).innerHTML =
      BOOKS.filter(b => b.t === t).map(b => `
        <div class="book-card ${S.bk?.id === b.id ? 'last-visited' : ''}" onclick="goChList('${b.id}')">
          <div class="book-card-name">${b.name}</div>
          <div class="book-card-sub">${b.c}ì¥</div>
        </div>`).join('');
  });
}

function renderChList() {
  if (!S.bk) return;
  document.getElementById('chGrid').innerHTML =
    Array.from({length: S.bk.c}, (_, i) =>
      `<div class="ch-btn ${S.ch === i+1 ? 'last-visited' : ''}" onclick="goRead(${i+1})">${i+1}</div>`
    ).join('');
}

function goChList(bid) {
  S.bk = BOOKS.find(b => b.id === bid);
  S.view = 'chapter'; S.hist.push('chapter'); renderView();
  document.getElementById('bkSummaryWrap').innerHTML =
    `<button class="bk-summary-btn" onclick="openBookAi()">âœ¨ ${S.bk.name} ì „ì²´ AI ìš”ì•½ ë³´ê¸°</button>`;
  renderChList();
}

function goRead(ch) {
  S.ch = ch; S.view = 'read'; S.hist.push('read');
  renderView(); updateProgress(); loadVerses();
}

function updateProgress() {
  if (!S.bk) return;
  const pct = Math.round((S.ch / S.bk.c) * 100);
  document.getElementById('progressInfo').innerHTML = `<b>${S.bk.name}</b>&nbsp; ${S.ch} / ${S.bk.c}ì¥`;
  document.getElementById('progressFill').style.width = pct + '%';
  document.getElementById('progressPct').innerText = pct + '%';
}

function selectVerse(idx) {
  const same = selIdx === idx; clearSel();
  if (same) return;
  selIdx = idx;
  document.getElementById(`v-${idx}`).classList.add('hl');
}
function clearSel() {
  selIdx = -1;
  document.querySelectorAll('.verse-row').forEach(el => el.classList.remove('hl'));
}

async function loadVerses() {
  clearSel();
  const wrap = document.getElementById('versesWrap');
  wrap.innerHTML = `<div class="loading-box">
    <div class="typing" style="justify-content:center"><span></span><span></span><span></span></div>
    <div style="margin-top:12px">ë§ì”€ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
  </div>`;
  try {
    const res  = await fetch(`${WORKER_URL}/bible?book=${S.bk.id}&chapter=${S.ch}`);
    const data = await res.json();
    S.cache[`${S.bk.id}_${S.ch}`] = data.verses;
    wrap.innerHTML = data.verses.map((v, i) => `
      <div class="verse-row" id="v-${i}" onclick="selectVerse(${i})" style="animation-delay:${Math.min(i*.02,.4)}s">
        <div class="verse-main">
          <div class="vn">${i+1}</div>
          <div class="vt">${v}</div>
        </div>
        <div class="verse-actions">
          <button class="va-btn va-btn-ai" onclick="doExplain(${i},event)">âœ¨ AI í•´ì„¤</button>
          <button class="va-btn" onclick="doBookmark(${i},event)">ğŸ”– ì €ì¥</button>
        </div>
      </div>`).join('');
    window.scrollTo(0, 0);
  } catch(e) {
    wrap.innerHTML = `<div class="loading-box">ë³¸ë¬¸ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨ ğŸ˜¢<br>ì ê¹ í›„ ë‹¤ì‹œ ëˆŒëŸ¬ë´</div>`;
  }
}

function doExplain(idx, e) {
  e.stopPropagation();
  const text = S.cache[`${S.bk.id}_${S.ch}`]?.[idx];
  if (!text) return;
  document.getElementById('aiVerseRef').innerText  = `${S.bk.name} ${S.ch}ì¥ ${idx+1}ì ˆ`;
  document.getElementById('aiVerseText').innerText = text;
  document.getElementById('aiVerseQuote').style.display = 'block';
  showAi('AI í•´ì„¤',
    `"${text}" (${S.bk.name} ${S.ch}ì¥ ${idx+1}ì ˆ) ì´ ë§ì”€ì„ ì²˜ìŒ ì„±ê²½ ì½ëŠ” ì¹œêµ¬í•œí…Œ ì„¤ëª…í•´ì£¼ë“¯ ì‰½ê³  ì¬ë°Œê²Œ ë°˜ë§ë¡œ í•´ì„¤í•´ì¤˜. ì˜ì  ì˜ë¯¸ë‘ ì˜¤ëŠ˜ë‚  ì ìš©ë²•ë„ ì•Œë ¤ì¤˜. ì´ëª¨ì§€ ì ë‹¹íˆ ì¨ì¤˜.`
  );
}
function doBookmark(idx, e) {
  e.stopPropagation();
  const text = S.cache[`${S.bk.id}_${S.ch}`]?.[idx];
  if (!text) return;
  let bms = getBms();
  if (bms.find(b => b.bookId===S.bk.id && b.chapter===S.ch && b.verseIdx===idx)) {
    alert('ì´ë¯¸ ì €ì¥ëœ ë§ì”€ì´ì•¼! ğŸ™'); return;
  }
  bms.push({id:Date.now(), bookId:S.bk.id, bookName:S.bk.name, chapter:S.ch, verseIdx:idx, text});
  saveBms(bms);
  alert(`${S.bk.name} ${S.ch}:${idx+1} ì €ì¥ëì–´! ğŸ”–`);
}

function renderView() {
  document.getElementById('vHome').style.display    = S.view==='home'    ? 'block' : 'none';
  document.getElementById('vChapter').style.display = S.view==='chapter' ? 'block' : 'none';
  document.getElementById('vRead').style.display    = S.view==='read'    ? 'block' : 'none';

  const isBm = document.getElementById('tab-bookmarks').classList.contains('on');
  document.getElementById('btnBack').disabled = (S.hist.length <= 1) && !isBm;

  const logo  = document.getElementById('hdrLogo');
  const crumb = document.getElementById('hdrCrumb');
  const aibtn = document.getElementById('hdrAiBtn');

  if (S.view === 'home') {
    logo.style.display  = 'flex';
    crumb.style.display = 'none';
    aibtn.style.display = 'none';
  } else {
    logo.style.display  = 'none';
    crumb.style.display = 'block';
    crumb.innerText     = S.view==='chapter' ? S.bk.name : `${S.bk.name} ${S.ch}ì¥`;
    aibtn.style.display = S.view==='read' ? 'flex' : 'none';
  }
}

function goBack() {
  if (document.getElementById('tab-bookmarks').classList.contains('on')) { switchTab('bible'); return; }
  if (S.hist.length <= 1) return;
  S.hist.pop(); S.view = S.hist[S.hist.length-1];
  clearSel();
  if (S.view === 'home')   renderBooks();
  if (S.view === 'chapter') renderChList();
  renderView();
}
function goHome() {
  if (document.getElementById('tab-bookmarks').classList.contains('on')) switchTab('bible');
  S.view = 'home'; S.hist = ['home'];
  clearSel(); renderBooks(); renderView();
}
function changeCh(d) {
  let n = S.ch + d, idx = BOOKS.findIndex(b => b.id === S.bk.id);
  if (n > S.bk.c) {
    if (idx < BOOKS.length-1) { S.bk = BOOKS[idx+1]; S.ch = 1; }
    else { alert('ë§ˆì§€ë§‰ ì¥ì´ì•¼! ğŸ™'); return; }
  } else if (n < 1) {
    if (idx > 0) { S.bk = BOOKS[idx-1]; S.ch = S.bk.c; }
    else { alert('ì²« ë²ˆì§¸ ì¥ì´ì•¼! ğŸ™'); return; }
  } else { S.ch = n; }
  renderView(); updateProgress(); loadVerses();
}

function getBms()   { return JSON.parse(localStorage.getItem('bible_bm')||'[]'); }
function saveBms(b) { localStorage.setItem('bible_bm', JSON.stringify(b)); }
function renderBookmarks() {
  const bms = getBms(), wrap = document.getElementById('bmWrap');
  if (!bms.length) {
    wrap.innerHTML = '<div class="bm-empty">ì•„ì§ ë¶ë§ˆí¬ê°€ ì—†ì–´ ğŸ™<br>ë§ˆìŒì— ë“œëŠ” êµ¬ì ˆ ì €ì¥í•´ë´!</div>';
    return;
  }
  let html = `<div class="bm-header"><span class="bm-count">ì´ ${bms.length}ê°œ</span><button class="bm-clear-btn" onclick="clearBms()">ì „ì²´ ì‚­ì œ</button></div><div class="bm-list">`;
  [...bms].reverse().forEach(b => {
    html += `<div class="bm-card"><div class="bm-top"><div class="bm-title" onclick="goToBm('${b.bookId}',${b.chapter})">ğŸ“– ${b.bookName} ${b.chapter}:${b.verseIdx+1} â†’</div><button class="bm-del" onclick="delBm(${b.id})">ğŸ—‘</button></div><div class="bm-verse-text">${b.text}</div></div>`;
  });
  wrap.innerHTML = html + '</div>';
}
function delBm(id) { if(!confirm('ì´ ë¶ë§ˆí¬ ì‚­ì œí• ê¹Œ?'))return; saveBms(getBms().filter(b=>b.id!==id)); renderBookmarks(); }
function clearBms() { if(!confirm('ì „ë¶€ ì‚­ì œí• ê¹Œ?'))return; saveBms([]); renderBookmarks(); }
function goToBm(bookId, ch) { switchTab('bible'); S.bk=BOOKS.find(b=>b.id===bookId); S.hist=['home','chapter']; goRead(ch); }

async function showAi(title, prompt) {
  document.getElementById('overlay').style.display = 'block';
  document.getElementById('aiSheet').classList.add('on');
  document.getElementById('shTitle').innerText = title;
  const body = document.getElementById('shBody');
  body.innerHTML = '<div class="typing"><span></span><span></span><span></span></div>';
  try {
    const res  = await fetch(`${WORKER_URL}/ai`, {method:'POST', body:JSON.stringify({prompt})});
    const data = await res.json();
    body.innerHTML = `<div class="ai-text">${
      data.text.replace(/\*\*(.*?)\*\*/g,'<strong>$1</strong>').replace(/\n/g,'<br>')
    }</div>`;
  } catch(e) {
    body.innerHTML = '<div class="ai-text" style="color:var(--text3)">ì—°ê²° ì‹¤íŒ¨ ğŸ˜¢ ì ê¹ í›„ ë‹¤ì‹œ ëˆŒëŸ¬ë´</div>';
  }
}
function openChapterAi() {
  document.getElementById('aiVerseQuote').style.display = 'none';
  showAi(`${S.bk.name} ${S.ch}ì¥ ìš”ì•½`,
    `${S.bk.name} ${S.ch}ì¥ ë§ì”€ì„ ì²˜ìŒ ì„±ê²½ ì½ëŠ” ì¹œêµ¬í•œí…Œ ì–˜ê¸°í•´ì£¼ë“¯ì´ ì‰½ê³  ì¬ë°Œê²Œ ë°˜ë§ë¡œ ìš”ì•½í•´ì¤˜. ì´ëª¨ì§€ë„ ì ë‹¹íˆ ì¨ì¤˜.`);
}
function openBookAi() {
  document.getElementById('aiVerseQuote').style.display = 'none';
  showAi(`${S.bk.name} ì „ì²´ ìš”ì•½`,
    `${S.bk.name} ì„±ê²½ ì „ì²´ë¥¼ ì²˜ìŒ ì ‘í•˜ëŠ” MZì„¸ëŒ€ ì¹œêµ¬í•œí…Œ ì„¤ëª…í•´ì£¼ë“¯ ì¬ë°Œê³  ì‰½ê²Œ ë°˜ë§ë¡œ ìš”ì•½í•´ì¤˜. í•µì‹¬ ë©”ì‹œì§€ì™€ ì˜¤ëŠ˜ë‚  ì ìš© í¬ì¸íŠ¸ í¬í•¨, ì´ëª¨ì§€ ì ë‹¹íˆ.`);
}
function closeAi() {
  document.getElementById('overlay').style.display = 'none';
  document.getElementById('aiSheet').classList.remove('on');
}

window.onload = () => { 
  applyTheme(theme); 
  applyFontSize(vSize); /* ì €ì¥ëœ í°íŠ¸ í¬ê¸° ë¶ˆëŸ¬ì˜¤ê¸° */
  renderBooks(); 
  renderView(); 
};
</script>

</body>
</html>
